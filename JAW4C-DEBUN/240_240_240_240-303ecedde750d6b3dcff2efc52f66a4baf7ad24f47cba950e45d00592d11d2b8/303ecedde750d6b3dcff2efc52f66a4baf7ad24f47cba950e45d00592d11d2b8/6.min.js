

    $(function () {
      //头部的跳转按钮，用于跳过header。主要解决的是希望键盘用户不要重复看到导航栏
      $('.skip-to-main-button').on('click', function () {
        var headerContainer = $('#headerContainer');
        if (headerContainer.length) { // 检查是否存在 #headerContainer
          var nextFocusableElement = findFirstFocusableElement(headerContainer.nextAll());
          if (nextFocusableElement) {
            nextFocusableElement.focus(); // 聚焦第一个可聚焦的元素
          } else {
            console.log('没有找到可聚焦的元素');
          }
        }
      });

      function findFirstFocusableElement (elements) {
        for (var i = 0; i < elements.length; i++) {
          var element = $(elements[i]);
          if (element.is(':input, a, button, [tabindex], [contenteditable="true"]')) {
            return element; // 返回第一个可聚焦的元素
          }
          var childFocusableElement = findFirstFocusableElement(element.children());
          if (childFocusableElement) {
            return childFocusableElement; // 返回子元素中的第一个可聚焦的元素
          }
        }
        return null; // 如果没有找到可聚焦的元素，返回 null
      }
    });

    //底部subscribe旁边提示按钮的ada适配
    $(function () {
      var followTitle = $('.tp-follow-title');
      var followIcon = followTitle.find('.tp-follow-icon')
      var followTip = followTitle.find('tp-follow-tip')
      followIcon.on('click', function () {
        if (followTitle.hasClass('active')) {
          followTitle.removeClass('active');
        } else {
          followTitle.addClass('active');
          followTip.focus()

        }
      })

    })

    //监听导航栏的hover，当检测到这个区域被hover或者focus的时候就打开
    $(function () {
      $('.tp-soho-nav-li .arrow-img').on('keydown', function (event) {
        if (event.key === 'Enter') {
          // 获取当前按钮的父元素
          var parentLi = $(this).closest('.tp-soho-nav-li');
          $('.tp-soho-nav-li').not(parentLi).removeClass('active');
          // 触发 mouseenter 事件
          parentLi.addClass('active');
        }
      });
      $('.tp-soho-nav-li .arrow-img').on('click', function () {

        // 获取当前按钮的父元素
        var parentLi = $(this).closest('.tp-soho-nav-li');
        $('.tp-soho-nav-li').not(parentLi).removeClass('active');
        // 触发 mouseenter 事件
        parentLi.addClass('active');

      });
      // 获取导航栏元素
      var navBar = $('.tp-soho-nav-li');

      // 添加鼠标悬停事件监听器
      navBar.on('mouseover', function (event) {
        openNavBar($(this));
      });

      // 定义打开导航栏的函数
      function openNavBar (parentLi) {
        // 移除其他导航项的 active 类
        $('.tp-soho-nav-li').not(parentLi).removeClass('active');
        // 添加当前导航项的 active 类
        parentLi.addClass('active');
      }
      // 添加鼠标悬停事件监听器
      navBar.on('mouseout', function (event) {
        $(this).removeClass('active');

      });



      var navBarItemm = $('.tp-soho-sub-nav');
      // 可选：添加鼠标离开事件监听器以关闭导航栏
      navBarItemm.on('mouseout', function (event) {
        closeNavBar($(this));
      });

      // 定义关闭导航栏的函数
      function closeNavBar (currentTarget) {
        // 移除 active 类
        const parentLi = currentTarget.closest('.tp-soho-nav-li');
        parentLi.removeClass('active');
      }
      var offNavTab = true;
      $('.page-content-wrapper').on('keydown', function (event) {
        var activeElement = document.activeElement;

        if (event.key === 'Tab') {
          if (!$(activeElement).closest('.tp-soho-nav-box').length) {
            if (!offNavTab) {
              offNavTab = true;
              $('.tp-soho-nav-li').removeClass('active');
            }
          } else if ($(activeElement).closest('.tp-soho-nav-box').length) {
            offNavTab = false
          }
        } else if (event.key === 'Escape') {
          // 找到最近的 .tp-soho-nav-li 元素并设置焦点
          var closestNavItem = $(activeElement).closest('.tp-soho-nav-li');
          console.log(closestNavItem)
          closestNavItem.removeClass('active')
          if (closestNavItem.length) {
            closestNavItem.find('#tp-ada-hiddenButton').focus();

          } else {
            // 如果没有找到最近的 .tp-soho-nav-li，可以设置默认的导航项
            navBar.focus();
          }
        }
      });

    })

  